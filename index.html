<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>May Auto Editor V3</title>

<style>
body {
    background: #0f0f0f;
    color: white;
    font-family: Arial, sans-serif;
    text-align: center;
    padding: 20px;
}

.container {
    max-width: 600px;
    margin: auto;
}

canvas {
    width: 100%;
    border-radius: 10px;
    margin-top: 20px;
    background: black;
}

button {
    padding: 12px 20px;
    margin: 10px;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    font-size: 16px;
}

.primary { background: #00c853; color: white; }
.danger { background: #d50000; color: white; }

</style>
</head>
<body>

<div class="container">
    <h1>ðŸŽ¬ May Auto Editor V3</h1>
    <p>Chuyá»ƒn áº£nh thÃ nh video quay nhÆ° tháº­t</p>

    <input type="file" id="imageInput" accept="image/*">

    <canvas id="canvas"></canvas>

    <div>
        <button class="primary" onclick="startRender()">Táº¡o Video</button>
        <button class="danger" onclick="downloadVideo()">Táº£i Video</button>
    </div>

    <p id="status"></p>
</div>

<script>

let img = new Image();
let canvas = document.getElementById("canvas");
let ctx = canvas.getContext("2d");
let animationFrame;
let recorder;
let chunks = [];
let recordedBlob;

document.getElementById("imageInput").addEventListener("change", function(e) {
    const file = e.target.files[0];
    if (file) {
        img.src = URL.createObjectURL(file);
        img.onload = () => {
            canvas.width = 720;
            canvas.height = 1280;
            drawFrame(0);
            document.getElementById("status").innerText = "áº¢nh Ä‘Ã£ táº£i.";
        };
    }
});

function drawFrame(progress) {
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    let scale = 1 + progress * 0.3; // zoom nháº¹
    let offsetX = progress * 100;   // pan ngang

    let imgWidth = img.width * scale;
    let imgHeight = img.height * scale;

    ctx.drawImage(
        img,
        -offsetX,
        0,
        imgWidth,
        imgHeight
    );
}

function startRender() {

    if (!img.src) {
        alert("Vui lÃ²ng chá»n áº£nh trÆ°á»›c!");
        return;
    }

    chunks = [];
    const stream = canvas.captureStream(30);
    recorder = new MediaRecorder(stream);

    recorder.ondataavailable = e => chunks.push(e.data);
    recorder.onstop = () => {
        recordedBlob = new Blob(chunks, { type: "video/webm" });
        document.getElementById("status").innerText = "Video Ä‘Ã£ táº¡o xong!";
    };

    recorder.start();

    let duration = 10; // 10 giÃ¢y
    let fps = 30;
    let totalFrames = duration * fps;
    let currentFrame = 0;

    function animate() {
        let progress = currentFrame / totalFrames;
        drawFrame(progress);
        currentFrame++;

        if (currentFrame < totalFrames) {
            animationFrame = requestAnimationFrame(animate);
        } else {
            recorder.stop();
        }
    }

    animate();
}

function downloadVideo() {
    if (!recordedBlob) {
        alert("ChÆ°a táº¡o video!");
        return;
    }

    const url = URL.createObjectURL(recordedBlob);
    const a = document.createElement("a");
    a.href = url;
    a.download = "may-auto-editor-v3.webm";
    a.click();
}

</script>

</body>
</html>
